/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @package yii2-editable
 * @version 1.0.0
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2014
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,i){return null===t||void 0===t||t==[]||""===t||i&&""===e.trim(t)},i=function(t,i){this.$element=e(t),this.init(i),this.listen()};i.prototype={constructor:i,init:function(t){var i=this;i.$container=e("#"+t.containerId),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$popover=i.$container.find(".kv-editable-popover"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),i.valueIfNull=t.valueIfNull,i.placement=t.placement},refreshPosition:function(){var t,i=this,n=i.$popover,o=i.placement,a=i.$target,r=n[0].offsetWidth,s=n[0].offsetHeight,l=e.extend({},a.position(),{width:a[0].offsetWidth,height:a[0].offsetHeight});switch(o){case"bottom":t={top:l.top+l.height,left:l.left+l.width/2-r/2};break;case"top":t={top:l.top-s,left:l.left+l.width/2-r/2};break;case"left":t={top:l.top+l.height/2-s/2,left:l.left-r};break;case"right":t={top:l.top+l.height/2-s/2,left:l.left+l.width}}n.css(t)},listen:function(){var i=this,n=i.$form,o=i.$btnSubmit,a=i.$btnReset,r=n.parent(),s=i.$popover,l=i.$loading,c=i.$element,d=i.valueIfNull,f=c.closest(".field-"+c.attr("id")),h=c.parent(),u=f.find(".help-block"),p=n.find('input[name="hasEditable"]'),v=t(f.attr("class"))||t(u.attr("class"));n.on("submit",function(e){e.preventDefault()}),n.on("keyup",function(e){13==e.which&&o.trigger("click")}),n.on("reset",function(){setTimeout(function(){n.data("kvEditableSubmit",!1),v?(h.find(".help-block").remove(),h.removeClass("has-error")):(f.removeClass("has-error"),u.html(" ")),s.popoverX("refreshPosition")},200)}),n.find("input, select").on("change",function(){s.popoverX("refreshPosition")}),a.on("click",function(){p.val(0),setTimeout(function(){n[0].reset()},200)}),o.on("click",function(){r.addClass("kv-editable-processing"),l.show(),p.val(1),n.find("input, select").each(function(){var t=e(this);t.trigger("change")});var o="",a=i.$form.data("yiiActiveForm");e.ajax({type:n.attr("method"),url:n.attr("action"),data:n.serialize(),dataType:"json",success:function(c){var p=t(c.output)?i.$element.val():c.output;if(s.popoverX("refreshPosition"),!t(c.message)){var m=h.find(".help-block");return v?(t(m.attr("class"))&&(m=e(document.createElement("div")).attr({"class":"help-block"}).appendTo(h)),m.html(c.message),h.addClass("has-error")):(f.addClass("has-error"),u.html(c.message)),l.hide(),void r.removeClass("kv-editable-processing")}n.find(".help-block").each(function(){return o=e(this).text(),t(o.trim())?void 0:void l.hide()}),t(o.trim())&&(l.hide(),t(p)&&(p=d),v?(h.find(".help-block").remove(),h.removeClass("has-error"),u.html(""),s.popoverX("hide"),i.$value.html(p)):(f.removeClass("has-error"),u.html(""),s.popoverX("hide"),i.$value.html(p),void 0!=a&&(n.yiiActiveForm("destroy"),n.yiiActiveForm(a.attributes,a.settings)))),r.removeClass("kv-editable-processing")}})})}},e.fn.editable=function(t){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var o=e(this),a=o.data("editable"),r="object"==typeof t&&t;a||o.data("editable",a=new i(this,e.extend({},e.fn.editable.defaults,r,e(this).data()))),"string"==typeof t&&a[t].apply(a,n)})},e.fn.editable.defaults={containerId:"",valueIfNull:"<em>(not set)</em>",placement:"right"}}(window.jQuery);